<div class="dux-page-header am-cf">
    <div class="page-title">
        <a class="am-btn am-btn-primary" href="{url('index')}"> 模板列表</a>
    </div>
    <div class="page-action">
        <a class="am-btn am-btn-danger" href="javascript:location.reload();"><i class="am-icon-refresh"></i></a>
    </div>
</div>
<div class="dux-body">
    <div class="am-panel am-panel-default dux-panel">
        <div class="am-panel-hd">{$assignName}模板</div>
        <div class="am-panel-bd">
            <form class="am-form  am-form-horizontal dux-form" data-dux="form-bind" method="post">
                <fieldset>
                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">模板名称</label>
                        <div class="am-u-md-10 am-u-sm-12">
                            <input type="text" name="name" value="{$info.name}" placeholder="请输入模板名称" required>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">首重默认</label>
                        <div class="am-u-md-10 am-u-sm-12" data-dux="form-location">
                            <div class="dux-g">
                                <div class="am-u-md-6">
                                    <div class="am-input-group">
                                        <input type="number" class="am-form-field" name="first_weight"
                                               value="{$info.first_weight ? $info.first_weight : 1000}" min="500">
                                        <span class="am-input-group-label">克</span>
                                    </div>
                                </div>
                                <div class="am-u-md-6">
                                    <div class="am-input-group">
                                        <input type="text" class="am-form-field" name="first_price"
                                               value="{$info.first_price ? $info.first_price : '0.00'}">
                                        <span class="am-input-group-label">元</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">续重默认</label>
                        <div class="am-u-md-10 am-u-sm-12" data-dux="form-location">
                            <div class="dux-g">
                                <div class="am-u-md-6">

                                    <div class="am-input-group">
                                        <input type="number" class="am-form-field" name="second_weight"
                                               value="{$info.first_weight ? $info.first_weight : 1000}" min="500">
                                        <span class="am-input-group-label">克</span>
                                    </div>
                                </div>
                                <div class="am-u-md-6">
                                    <div class="am-input-group">
                                        <input type="text" class="am-form-field" name="second_price"
                                               value="{$info.second_price ? $info.second_price : '0.00'}">
                                        <span class="am-input-group-label">元</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">保价状态</label>
                        <div class="am-u-md-10 am-u-sm-12">
                            <div>
                                <select name="support_status" data-am-selected="{btnWidth: '100%'}" required>
                                    <option value="1" <!--if{$info['support_status']}--> selected <!--{/id}-->
                                    >使用</option>
                                    <option value="0" <!--if{!$info['support_status']}--> selected <!--{/id}-->
                                    >不使用</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">保价费率</label>
                        <div class="am-u-md-10 am-u-sm-12">
                            <div class="am-input-group">
                                <input type="text" class="am-form-field" name="support_rate"
                                       value="{$info.support_rate ? $info.support_rate : '0.00'}">
                                <span class="am-input-group-label">%</span>
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">最低保费</label>
                        <div class="am-u-md-10 am-u-sm-12">
                            <div class="am-input-group">
                                <input type="text" class="am-form-field" name="support_price"
                                       value="{$info.support_price ? $info.support_price : '0.00'}">
                                <span class="am-input-group-label">元</span>
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-md-2 am-u-sm-12 am-form-label">配送地区</label>
                        <div class="am-u-md-10 am-u-sm-12">
                            <div class="am-input-group">
                                <div class="am-margin-bottom">
                                    <button class="am-btn am-btn-success" type="button" id="add-area">增加地区</button>
                                </div>
                            </div>
                            <table class="am-table dux-table-dialog">
                                <thead>
                                <tr>
                                    <th width="120">首重费用</th>
                                    <th width="120">续重费用</th>
                                    <th>地区</th>
                                    <th width="80" class="am-text-center">管理</th>
                                </tr>
                                </thead>
                                <tbody class="js-data-list">
                                    <!--if{$areaData}-->
                                        <!--loop{$areaData as $key => $vo}-->
                                            <tr id="area_{$key}">
                                                <td><input type="text" name="area[first_price][]" value="{$vo.first_price}"></td>
                                                <td><input type="text" name="area[second_price][]" value="{$vo.second_price}"></td>
                                                <td>
                                                    <a href="javascript:;" class="sel-area">选择地区</a>
                                                    <span class="area">{$vo.area}</span>
                                                    <input type="hidden" name="area[area][]" value="{$vo.area}">
                                                </td>
                                                <td class="am-text-center">
                                                    <a href="javascript:;" class="am-btn am-btn-danger am-btn-sm js-del am-icon-remove"></a>
                                                </td>
                                            </tr>
                                        <!--{/loop}-->
                                    <!--{/if}-->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="am-form-group">
                        <div class="am-u-sm-offset-12 am-u-md-offset-2">
                            <input type="hidden" name="delivery_id" value="{$info.delivery_id}">
                            <button class="am-btn am-btn-primary" type="submit" disabled>保存</button>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>

<script id="tpl-area" type="text/html">
    <tr id="area_{{ d.i }}">
        <td><input type="text" name="area[first_price][]" value="0.00"></td>
        <td><input type="text" name="area[second_price][]" value="0.00"></td>
        <td>
            <a href="javascript:;" class="sel-area">选择地区</a>
            <span class="area"></span>
            <input type="hidden" name="area[area][]" value="">
        </td>
        <td class="am-text-center">
            <a href="javascript:;" class="am-btn am-btn-danger am-btn-sm js-del am-icon-remove"></a>
        </td>
    </tr>
</script>

<script>
    Do('base', 'tpl', 'dialog', function () {
        var i = 1;
        $('#add-area').on('click', function () {
            var gettpl = $('#tpl-area').html();
            i++;
            laytpl(gettpl).render({i: i}, function (html) {
                $('.js-data-list').append(html);
            });
        });

        $('.js-data-list').on('click', '.js-del', function() {
            $(this).parents('tr').remove();
        });

        $('.js-data-list').on('click', '.sel-area', function() {
            var id = $(this).parents('tr').attr('id');
            layer.open({
                type: 2,
                title: '选择地区',
                shadeClose: true,
                shade: 0.8,
                area: ['640px', '400px'],
                content: '{url("area")}?id=' + id
            });
        });

        window.addArea = function (id, data) {
            var layout = $('#'+ id);
            layout.find('.area').text(data);
            layout.find('.area').next('input').val(data);
        }
    });
</script>